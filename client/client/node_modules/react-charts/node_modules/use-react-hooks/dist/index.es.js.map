{"version":3,"file":"index.es.js","sources":["../src/index.js"],"sourcesContent":["import React from 'react'\n\nlet currentFiber\n\n// Utils\nconst leaseHook = () => {\n  if (!currentFiber) {\n    throw new Error('You are trying to use hooks without the `useHooks()` HOC!')\n  }\n  const hooks = currentFiber.hooks\n  const index = currentFiber.hookIndex\n  currentFiber.hookIndex++\n  return [hooks, index, currentFiber]\n}\n\nexport function useHooks(fn) {\n  class HookComponent extends React.Component {\n    static displayName = fn.displayName || fn.name\n\n    hooks = [] // A home for our hooks\n\n    // These are here to ensure effects work properly\n    componentDidMount() {\n      this.hooks.forEach(hook => {\n        if (hook.didMount) {\n          hook.didMount()\n        }\n      })\n    }\n    componentDidUpdate() {\n      this.hooks.forEach(hook => {\n        if (hook.didUpdate) {\n          hook.didUpdate()\n        }\n      })\n    }\n    componentWillUnmount() {\n      this.hooks.forEach(hook => {\n        if (hook.willUnmount) {\n          hook.willUnmount()\n        }\n      })\n      this.hooks = undefined\n    }\n\n    render() {\n      const { innerRef, ...rest } = this.props\n      // Every render, we need to update the\n      // currentFiber to the class's instance\n      // and reset the instance's hookIndex\n      currentFiber = this\n      this.hookIndex = 0\n      const res = fn(rest, innerRef)\n      currentFiber = null\n      return res\n    }\n  }\n  function HookWrapper(props, ref) {\n    return <HookComponent {...props} innerRef={ref} />\n  }\n  Object.keys(fn).forEach(key => {\n    HookWrapper[key] = fn[key]\n  })\n  return HookWrapper\n}\n\nexport function useRef(initialValue) {\n  const [hooks, hookID] = leaseHook()\n  if (!hooks[hookID]) {\n    hooks[hookID] = {\n      current: initialValue\n    }\n  }\n  return hooks[hookID]\n}\n\nexport function useReducer(reducer, initialState) {\n  const [hooks, hookID, instance] = leaseHook()\n  if (!hooks[hookID]) {\n    hooks[hookID] = {\n      state: initialState,\n      dispatch: action => {\n        hooks[hookID].state = reducer(hooks[hookID].state, action)\n        instance.forceUpdate()\n      }\n    }\n  }\n  return [hooks[hookID].state, hooks[hookID].dispatch]\n}\n\nexport function useState(initialState) {\n  return useReducer(\n    (state, action) => (typeof action === 'function' ? action(state) : action),\n    initialState\n  )\n}\n\nexport function useContext(context) {\n  const [hooks, hookID, instance] = leaseHook()\n  if (!hooks[hookID]) {\n    hooks[hookID] = context\n    const originalRender = instance.render.bind(instance)\n    instance.render = () => (\n      <context.Consumer>{originalRender}</context.Consumer>\n    )\n  }\n  return context._currentValue\n}\n\nexport function usePrevious(value, watchItems) {\n  const [hooks, hookID] = leaseHook()\n  if (!hooks[hookID]) {\n    hooks[hookID] = {}\n  }\n  useEffect(() => {\n    hooks[hookID].previous = value\n  }, watchItems)\n  return hooks[hookID].previous\n}\n\nexport function useMemo(memo, watchItems) {\n  const [hooks, hookID] = leaseHook()\n  if (!hooks[hookID]) {\n    hooks[hookID] = {\n      watchItems: null,\n      computed: null\n    }\n  }\n  let needsUpdate = hasChanged(hooks[hookID].watchItems, watchItems)\n  if (needsUpdate) {\n    hooks[hookID].watchItems = watchItems\n    hooks[hookID].computed = memo()\n  }\n  return hooks[hookID].computed\n}\n\nexport function useCallback(callback, watchItems) {\n  return useMemo(() => callback, watchItems)\n}\n\nexport function useEffect(effect, watchItems) {\n  const [hooks, hookID] = leaseHook()\n  if (!hooks[hookID]) {\n    hooks[hookID] = {\n      changed: false,\n      watchItems: null,\n      unwinder: null,\n      effect: null,\n      didMount: () => {\n        hooks[hookID].unwind = hooks[hookID].effect()\n      },\n      didUpdate: () => {\n        if (hooks[hookID].changed) {\n          if (hooks[hookID].unwind) {\n            hooks[hookID].unwind()\n          }\n          hooks[hookID].unwind = hooks[hookID].effect()\n        }\n      },\n      willUnmount: () => {\n        if (hooks[hookID].unwind) {\n          hooks[hookID].unwind()\n        }\n      }\n    }\n  }\n\n  hooks[hookID].effect = effect\n  hooks[hookID].changed = false\n\n  let changed = hasChanged(hooks[hookID].watchItems, watchItems)\n  if (changed) {\n    hooks[hookID].changed = true\n    hooks[hookID].watchItems = watchItems\n  }\n}\n\nexport function useImperativeMethods(ref, createFn, watchItems) {\n  watchItems = watchItems ? watchItems.concat([ref]) : [ref, createFn]\n\n  useEffect(() => {\n    if (typeof ref === 'function') {\n      const methodsInstance = createFn()\n      ref(methodsInstance)\n      return () => ref(null)\n    } else if (ref !== null && ref !== undefined) {\n      const methodsInstance = createFn()\n      ref.current = methodsInstance\n      return () => {\n        ref.current = null\n      }\n    }\n  }, watchItems)\n}\n\nexport const useMutationEffect = useEffect\nexport const useLayoutEffect = useEffect\n\n// Utils\n\nfunction hasChanged(prev, next) {\n  let needsUpdate = !prev\n  if (!needsUpdate && prev.length !== next.length) {\n    needsUpdate = true\n  } else if (\n    !needsUpdate &&\n    prev.some((item, index) => {\n      return item !== next[index]\n    })\n  ) {\n    needsUpdate = true\n  }\n  return needsUpdate\n}\n"],"names":["currentFiber","leaseHook","Error","hooks","index","hookIndex","useHooks","fn","HookComponent","forEach","hook","didMount","didUpdate","willUnmount","undefined","props","innerRef","rest","res","React","Component","displayName","name","HookWrapper","ref","keys","key","useRef","initialValue","hookID","useReducer","reducer","initialState","instance","state","action","forceUpdate","dispatch","useState","useContext","context","originalRender","render","bind","_currentValue","usePrevious","value","watchItems","previous","useMemo","memo","needsUpdate","hasChanged","computed","useCallback","callback","useEffect","effect","unwind","changed","useImperativeMethods","createFn","concat","methodsInstance","current","useMutationEffect","useLayoutEffect","prev","next","length","some","item"],"mappings":"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"}